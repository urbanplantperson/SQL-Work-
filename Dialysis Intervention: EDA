--- Find most common procedures in the US, limit top 100 --- 
 SELECT 
  hcpcs_cd,
  COUNT(hcpcs_cd) AS count,
  hcpcs_desc
 FROM medicare_services_2020 
  WHERE rndrng_prvdr_cntry = 'US'
  GROUP BY hcpcs_cd, hcpcs_desc
  ORDER BY count DESC
 LIMIT 100;
hcpcs_cd | count  |   hcpcs_desc                                                                                                                            
----------+--------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 99213    | 460894 | Established patient office or other outpatient visit, typically 15 minutes
 99214    | 449763 | Established patient office or other outpatient, visit typically 25 minutes
 99232    | 172943 | Subsequent hospital inpatient care, typically 25 minutes per day
 99204    | 170977 | New patient office or other outpatient visit, typically 45 minutes
 99203    | 164212 | New patient office or other outpatient visit, typically 30 minutes
 G0008    | 135203 | Administration of influenza virus vaccine
 99223    | 131582 | Initial hospital inpatient care, typically 70 minutes per day
 99233    | 129113 | Subsequent hospital inpatient care, typically 35 minutes per day
 99212    | 113146 | Established patient office or other outpatient visit, typically 10 minutes
 99215    | 112779 | Established patient office or other outpatient, visit typically 40 minutes
 99222    |  98354 | Initial hospital inpatient care, typically 50 minutes per day
 99442    |  98267 | Physician telephone patient service, 11-20 minutes of medical discussion
 G0439    |  92005 | Annual wellness visit, includes a personalized prevention plan of service (pps), subsequent visit
 36415    |  90992 | Insertion of needle into vein for collection of blood sample
 90662    |  86655 | Vaccine for influenza for injection into muscle
 G0009    |  74429 | Administration of pneumococcal vaccine
 93000    |  71059 | Routine ekg using at least 12 leads including interpretation and report
 99291    |  68248 | Critical care delivery critically ill or injured patient, first 30-74 minutes
 97110    |  64572 | Therapeutic exercise to develop strength, endurance, range of motion, and flexibility, each 15 minutes
 99443    |  60810 | Physician telephone patient service, 21-30 minutes of medical discussion
 99284    |  59462 | Emergency department visit, problem of high severity
 96372    |  59204 | Injection beneath the skin or into muscle for therapy, diagnosis, or prevention
 99285    |  58809 | Emergency department visit, problem with significant threat to life or function
 71046    |  57268 | X-ray of chest, 2 views
 99231    |  56635 | Subsequent hospital inpatient care, typically 15 minutes per day
 99239    |  56046 | Hospital discharge day management, more than 30 minutes
 93010    |  55927 | Routine electrocardiogram (ekg) using at least 12 leads with interpretation and report
 99205    |  55602 | New patient office or other outpatient visit, typically 60 minutes
 97140    |  54251 | Manual (physical) therapy techniques to 1 or more regions, each 15 minutes
 90732    |  52471 | Vaccine for pneumococcal polysaccharide for injection beneath the skin or into muscle, patient 2 years or older
 99283    |  49543 | Emergency department visit, moderately severe problem
 81003    |  44561 | Automated urinalysis test
 99441    |  43117 | Physician telephone patient service, 5-10 minutes of medical discussion
 99202    |  42792 | New patient office or other outpatient visit, typically 20 minutes
 83036    |  42782 | Hemoglobin a1c level
 97112    |  42372 | Therapeutic procedure to re-educate brain-to-nerve-to-muscle function, each 15 minutes
 20610    |  41389 | Aspiration and/or injection of large joint or joint capsule
 73030    |  38872 | X-ray of shoulder, minimum of 2 views
 99238    |  38811 | Hospital discharge day management, 30 minutes or less
 97530    |  38619 | Therapeutic activities to improve function, with one-on-one contact between patient and provider, each 15 minutes
 00731    |  37958 | Anesthesia for procedure on esophagus, stomach, and/or upper small bowel using an endoscope
 92014    |  37476 | Eye and medical examination for diagnosis and treatment, established patient, 1 or more visits
 73502    |  37107 | X-ray of hip with pelvis, 2-3 views
 93306    |  36429 | Ultrasound examination of heart including color-depicted blood flow rate, direction, and valve function
 85025    |  34818 | Complete blood cell count (red cells, white blood cell, platelets), automated test
 99308    |  34505 | Subsequent nursing facility visit, typically 15 minutes per day
 90694    |  34250 | Influenza virus vaccine, quadrivalent (aiiv4), inactivated, adjuvanted, preservative free, for injection into muscle, 0.5 ml dosage
 99221    |  34106 | Initial hospital inpatient care, typically 30 minutes per day
 73630    |  34096 | X-ray of foot, minimum of 3 views
 99309    |  33534 | Subsequent nursing facility visit, typically 25 minutes per day
 90686    |  33171 | Vaccine for influenza for administration into muscle, 0.5 ml dosage
 90670    |  32863 | Pneumococcal vaccine for injection into muscle
 81002    |  32812 | Urinalysis, manual test
 99211    |  32158 | Established patient office or other outpatient visit, typically 5 minutes
 72100    |  30644 | X-ray of lower and sacral spine, 2 or 3 views
 J3301    |  30522 | Injection, triamcinolone acetonide, not otherwise specified, 10 mg
 99217    |  29776 | Hospital observation care on day of discharge
 74177    |  29599 | Ct scan of abdomen and pelvis with contrast
 99220    |  29431 | Hospital observation care, typically 70 minutes
 97161    |  27737 | Evaluation of physical therapy, typically 20 minutes
 71250    |  27650 | Ct scan chest
 73562    |  27567 | X-ray of knee, 3 views
 92004    |  27222 | Eye and medical examination for diagnosis and treatment, new patient, 1 or more visits
 97162    |  27103 | Evaluation of physical therapy, typically 30 minutes
: 99202    |  42792 | New patient office or other outpatient visit, typically 20 minutes

--- Find most expensive procedures in US (single procedure, not counting total patients who recieved procedure) --- 
--- surgery seems to be the most expensive procedure, followed by insertion of needle to a dialysis circuit --- 
SELECT
 hcpcd_cd,
 hcpcs_desc,
 avg_mdcr_stdzd_amnt 
FROM medicare_services_2020 
 WHERE rndrng_prvdr_cntry = 'US'
 GROUP BY hcpcs_cd, hcpcs_desc, avg_mdcr_stdzd_amnt 
 ORDER BY avg_mdcr_stdzd_amnt DESC 
 LIMIT 50;
 hcpcs_cd |                                                                               hcpcs_desc                                                                               | avg_mdcr_stdzd_amnt 
----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.99058824
 36902    | Insertion of needle and/or catheter into dialysis circuit and balloon dilation of dialysis segment, with imaging including radiological supervision and interpretation | 999.971875
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.95384615
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.94785714
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.94066667
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.93857143
 27130    | Replacement of thigh bone and hip joint prosthesis                                                                                                                     | 999.93842105
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.91428571
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.89384615
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.88916667
 15736    | Muscle flap wound repair of arm                                                                                                                                        | 999.85950413
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.854
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.83583333
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.83454545
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.83210526
 38724    | Removal of lymph nodes, muscle, and tissue of neck                                                                                                                     | 999.82
 29880    | Removal of both knee cartilages using an endoscope                                                                                                                     | 999.80611111
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.80611111
 78492    | Multiple nuclear medicine studies of blood flow in heart muscle at rest and with stress                                                                                | 999.79693069
 29880    | Removal of both knee cartilages using an endoscope                                                                                                                     | 999.79611111
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.79611111
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.78
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.75590909
 29880    | Removal of both knee cartilages using an endoscope                                                                                                                     | 999.75407407
 29880    | Removal of both knee cartilages using an endoscope                                                                                                                     | 999.75349206
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.74606061
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.744
 49505    | Repair of groin hernia patient age 5 years or older                                                                                                                    | 999.74133333
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.73625
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.73606061
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.72733333
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.7225
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.71928571
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.68272727
 A9500    | Technetium tc-99m sestamibi, diagnostic, per study dose                                                                                                                | 999.65646552
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.655625
 26123    | Removal of tissue of palm                                                                                                                                              | 999.65153846
 78492    | Multiple nuclear medicine studies of blood flow in heart muscle at rest and with stress                                                                                | 999.62869565
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.61
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.60647059
 27447    | Repair of knee joint                                                                                                                                                   | 999.60136364
 29881    | Removal of one knee cartilage using an endoscope                                                                                                                       | 999.58727273
 27447    | Repair of knee joint                                                                                                                                                   | 999.56125
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.56071429
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.55642857
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.543125
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.53166667
 65820    | Incision to improve eye fluid flow                                                                                                                                     | 999.51388889
 63042    | Re-exploration of spine repair with release of lower spinal cord or nerves                                                                                             | 999.50461538
 27245    | Surgical treatment of broken thigh bone                                                                                                                                | 999.5
(50 rows)

--- Find most expensive AND most utilized services --- not quite but something else... ---
SELECT hcpcs_cd, COUNT(hcpcs_cd) AS count, hcpcs_desc, avg_mdcr_stdzd_amnt 
FROM medicare_services_2020 
WHERE rndrng_prvdr_cntry = 'US' 
GROUP BY hcpcs_cd, hcpcs_desc, avg_mdcr_stdzd_amnt
ORDER BY count DESC
LIMIT 50;
hcpcs_cd | count  |                                                                     hcpcs_desc                                                                     | avg_mdcr_stdzd_amnt 
----------+--------+----------------------------------------------------------------------------------------------------------------------------------------------------+---------------------
 G0008    | 104498 | Administration of influenza virus vaccine                                                                                                          | 14.15
 36415    |  79086 | Insertion of needle into vein for collection of blood sample                                                                                       | 2.94
 G0009    |  65715 | Administration of pneumococcal vaccine                                                                                                             | 14.15
 G0439    |  64222 | Annual wellness visit, includes a personalized prevention plan of service (pps), subsequent visit                                                  | 114.95
 81003    |  40701 | Automated urinalysis test                                                                                                                          | 2.21
 83036    |  38522 | Hemoglobin a1c level                                                                                                                               | 9.52
 99233    |  38021 | Subsequent hospital inpatient care, typically 35 minutes per day                                                                                   | 83.19
 81002    |  30675 | Urinalysis, manual test                                                                                                                            | 3.41
 85025    |  29431 | Complete blood cell count (red cells, white blood cell, platelets), automated test                                                                 | 7.61
 99222    |  25123 | Initial hospital inpatient care, typically 50 minutes per day                                                                                      | 110.06
 90694    |  23494 | Influenza virus vaccine, quadrivalent (aiiv4), inactivated, adjuvanted, preservative free, for injection into muscle, 0.5 ml dosage                | 59.78
 99232    |  23269 | Subsequent hospital inpatient care, typically 25 minutes per day                                                                                   | 57.72
 99232    |  23246 | Subsequent hospital inpatient care, typically 25 minutes per day                                                                                   | 57.71
 99223    |  20770 | Initial hospital inpatient care, typically 70 minutes per day                                                                                      | 161.56
 G0008    |  20049 | Administration of influenza virus vaccine                                                                                                          | 12.03
 99231    |  19395 | Subsequent hospital inpatient care, typically 15 minutes per day                                                                                   | 31.41
 G0439    |  19228 | Annual wellness visit, includes a personalized prevention plan of service (pps), subsequent visit                                                  | 97.7
 84443    |  18129 | Blood test, thyroid stimulating hormone (tsh)                                                                                                      | 16.46
 90662    |  17651 | Vaccine for influenza for injection into muscle                                                                                                    | 59.76
 G0438    |  16802 | Annual wellness visit; includes a personalized prevention plan of service (pps), initial visit                                                     | 169.41
 85610    |  16103 | Blood test, clotting time                                                                                                                          | 4.2
 99238    |  15384 | Hospital discharge day management, 30 minutes or less                                                                                              | 58.29
 G0444    |  15227 | Annual depression screening, 15 minutes                                                                                                            | 18.04
 90686    |  14846 | Vaccine for influenza for administration into muscle, 0.5 ml dosage                                                                                | 19.19
 80053    |  14683 | Blood test, comprehensive group of blood chemicals                                                                                                 | 10.35
 81001    |  13389 | Manual urinalysis test with examination using microscope                                                                                           | 3.11
 80061    |  13084 | Blood test, lipids (cholesterol and triglycerides)                                                                                                 | 13.12
 87804    |  12892 | Detection test for influenza virus                                                                                                                 | 16.22
 99239    |  12839 | Hospital discharge day management, more than 30 minutes                                                                                            | 85.45
 G0101    |  11757 | Cervical or vaginal cancer screening; pelvic and clinical breast examination                                                                       | 39.97
 99223    |  11646 | Initial hospital inpatient care, typically 70 minutes per day                                                                                      | 161.55
 80048    |  11323 | Blood test, basic group of blood chemicals                                                                                                         | 8.29
 82570    |  10760 | Creatinine level to test for kidney function or muscle injury                                                                                      | 5.08
 82306    |  10741 | Vitamin d-3 level                                                                                                                                  | 29.01
 G0402    |  10374 | Initial preventive physical examination; face-to-face visit, services limited to new beneficiary during the first 12 months of medicare enrollment | 165.17
 99221    |  10315 | Initial hospital inpatient care, typically 30 minutes per day                                                                                      | 81.49
 77067    |   9652 | Mammography of both breasts                                                                                                                        | 38.55
 84439    |   9503 | Thyroxine (thyroid chemical) measurement                                                                                                           | 8.84
 82043    |   9326 | Urine microalbumin (protein) level                                                                                                                 | 5.66
 82607    |   9296 | Cyanocobalamin (vitamin b-12) level                                                                                                                | 14.78
 77080    |   9173 | Bone density measurement using dedicated x-ray machine                                                                                             | 9.9
 77063    |   8692 | Screening digital tomography of both breasts                                                                                                       | 30.06
 84153    |   7925 | Psa (prostate specific antigen) measurement                                                                                                        | 18.02
 99291    |   7910 | Critical care delivery critically ill or injured patient, first 30-74 minutes                                                                      | 177.69
 36620    |   7833 | Insertion of arterial catheter for blood sampling or infusion, accessed through the skin                                                           | 36.22
 82728    |   7289 | Ferritin (blood protein) level                                                                                                                     | 13.36
 99442    |   7210 | Physician telephone patient service, 11-20 minutes of medical discussion                                                                           | 59.7
 90682    |   7207 | Vaccine for influenza for injection into muscle                                                                                                    | 59.76
 77080    |   7174 | Bone density measurement using dedicated x-ray machine                                                                                             | 39.26
 76937    |   7164 | Ultrasound guidance for accessing into blood vessel                                                                                                | 11.6
(50 rows)

